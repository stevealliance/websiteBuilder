#!/usr/bin/env node


// -*- coding: utf-8 -*-
'use strict';
/* !
    region header
    Copyright Torben Sickert (info["~at~"]torben.website) 16.12.2012

    License
    -------

    This library written by Torben Sickert stand under a creative commons naming
    3.0 unported license. see http://creativecommons.org/licenses/by/3.0/deed.de
    endregion
*/
// region imports

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _child_process = require('child_process');

var _clientnode = require('clientnode');

var _clientnode2 = _interopRequireDefault(_clientnode);

var _fs = require('fs');

var fileSystem = _interopRequireWildcard(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _rimraf = require('rimraf');

var _rimraf2 = _interopRequireDefault(_rimraf);

var _configurator = require('./configurator.compiled');

var _configurator2 = _interopRequireDefault(_configurator);

var _helper = require('./helper.compiled');

var _helper2 = _interopRequireDefault(_helper);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// NOTE: Only needed for debugging this file.
try {
    require('source-map-support/register');
} catch (error) {}
// endregion
// NOTE: Specifies number of allowed threads to spawn.
// IgnoreTypeCheck
process.env.UV_THREADPOOL_SIZE = 128;
const main = (() => {
    var _ref = (0, _asyncToGenerator3.default)(function* () {
        try {
            // region controller
            const childProcessOptions = {
                cwd: _configurator2.default.path.context,
                env: process.env,
                shell: true,
                stdio: 'inherit'
            };
            const childProcesses = [];
            const processPromises = [];
            const possibleArguments = ['build', 'build:dll', 'clear', 'document', 'lint', 'preinstall', 'serve', 'test', 'test:browser', 'check:type'];
            const closeEventHandlers = [];
            if (_configurator2.default.givenCommandLineArguments.length > 2) {
                // region temporary save dynamically given configurations
                let dynamicConfiguration = { givenCommandLineArguments: _configurator2.default.givenCommandLineArguments.slice() };
                if (_configurator2.default.givenCommandLineArguments.length > 3 && _clientnode2.default.stringParseEncodedObject(_configurator2.default.givenCommandLineArguments[_configurator2.default.givenCommandLineArguments.length - 1], _configurator2.default, 'configuration')) _configurator2.default.givenCommandLineArguments.pop();
                let count = 0;
                let filePath = _path2.default.resolve(_configurator2.default.path.context, `.dynamicConfiguration-${count}.json`);
                while (true) {
                    filePath = _path2.default.resolve(_configurator2.default.path.context, `.dynamicConfiguration-${count}.json`);
                    if (!(yield _clientnode2.default.isFile(filePath))) break;
                    count += 1;
                }
                yield new _promise2.default(function (resolve, reject) {
                    return fileSystem.writeFile(filePath, (0, _stringify2.default)(dynamicConfiguration), function (error) {
                        return error ? reject(error) : resolve();
                    });
                });
                const additionalArguments = process.argv.splice(3);
                // / region register exit handler to tidy up
                closeEventHandlers.push(function (error) {
                    // NOTE: Close handler have to be synchronous.
                    if (_clientnode2.default.isFileSync(filePath)) fileSystem.unlinkSync(filePath);
                    if (error) throw error;
                });
                // / endregion
                // endregion
                // region handle clear
                /*
                    NOTE: Some tasks could depend on previously created dll
                    packages so a clean should not be performed in that case.
                    NOTE: If we have a dependency cycle we need to preserve files
                    during preinstall phase.
                */
                if (!['build', 'preinstall', 'serve', 'test', 'test:browser'].includes(_configurator2.default.givenCommandLineArguments[2]) && possibleArguments.includes(_configurator2.default.givenCommandLineArguments[2])) {
                    if (_path2.default.resolve(_configurator2.default.path.target.base) === _path2.default.resolve(_configurator2.default.path.context)) {
                        // Removes all compiled files.
                        yield _clientnode2.default.walkDirectoryRecursively(_configurator2.default.path.target.base, (() => {
                            var _ref2 = (0, _asyncToGenerator3.default)(function* (file) {
                                if (_helper2.default.isFilePathInLocation(file.path, _configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames, _configurator2.default.loader.directoryNames).map(function (filePath) {
                                    return _path2.default.resolve(_configurator2.default.path.context, filePath);
                                }).filter(function (filePath) {
                                    return !_configurator2.default.path.context.startsWith(filePath);
                                }))) return false;
                                for (const type in _configurator2.default.build.types) if (new RegExp(_configurator2.default.build.types[type].filePathPattern).test(file.path)) {
                                    if (file.stat.isDirectory()) {
                                        yield new _promise2.default(function (resolve, reject) {
                                            return (0, _rimraf2.default)(file.path, { glob: false }, function (error) {
                                                return error ? reject(error) : resolve();
                                            });
                                        });
                                        return false;
                                    }
                                    yield new _promise2.default(function (resolve, reject) {
                                        return fileSystem.unlink(file.path, function (error) {
                                            return error ? reject(error) : resolve();
                                        });
                                    });
                                    break;
                                }
                            });

                            return function (_x) {
                                return _ref2.apply(this, arguments);
                            };
                        })());
                        for (const file of yield _clientnode2.default.walkDirectoryRecursively(_configurator2.default.path.target.base, function () {
                            return false;
                        }, _configurator2.default.encoding)) if (file.name.length > '.dll-manifest.json'.length && file.name.endsWith('.dll-manifest.json') || file.name.startsWith('npm-debug')) yield new _promise2.default(function (resolve, reject) {
                            return fileSystem.unlink(file.path, function (error) {
                                return error ? reject(error) : resolve();
                            });
                        });
                    } else yield new _promise2.default(function (resolve, reject) {
                        return (0, _rimraf2.default)(_configurator2.default.path.target.base, { glob: false }, function (error) {
                            return error ? reject(error) : resolve();
                        });
                    });
                    if (yield _clientnode2.default.isDirectory(_configurator2.default.path.apiDocumentation)) yield new _promise2.default(function (resolve, reject) {
                        return (0, _rimraf2.default)(_configurator2.default.path.apiDocumentation, { glob: false }, function (error) {
                            return error ? reject(error) : resolve();
                        });
                    });
                }
                // endregion
                // region handle build
                const buildConfigurations = _helper2.default.resolveBuildConfigurationFilePaths(_configurator2.default.build.types, _configurator2.default.path.source.asset.base, _configurator2.default.path.ignore.concat(_configurator2.default.module.directoryNames, _configurator2.default.loader.directoryNames).map(function (filePath) {
                    return _path2.default.resolve(_configurator2.default.path.context, filePath);
                }).filter(function (filePath) {
                    return !_configurator2.default.path.context.startsWith(filePath);
                }), _configurator2.default.package.main.fileNames);
                if (['build', 'build:dll', 'document', 'test'].includes(process.argv[2])) {
                    let tidiedUp = false;
                    const tidyUp = function () {
                        /*
                            Determines all none javaScript entities which have been
                            emitted as single module to remove.
                        */
                        if (tidiedUp) return;
                        tidiedUp = true;
                        for (const chunkName in _configurator2.default.injection.internal.normalized) if (_configurator2.default.injection.internal.normalized.hasOwnProperty(chunkName)) for (const moduleID of _configurator2.default.injection.internal.normalized[chunkName]) {
                            const filePath = _helper2.default.determineModuleFilePath(moduleID, _configurator2.default.module.aliases, _configurator2.default.module.replacements.normal, _configurator2.default.extensions, _configurator2.default.path.context, _configurator2.default.path.source.asset.base, _configurator2.default.path.ignore, _configurator2.default.module.directoryNames, _configurator2.default.package.main.fileNames, _configurator2.default.package.main.propertyNames, _configurator2.default.package.aliasPropertyNames, _configurator2.default.encoding);
                            let type;
                            if (filePath) type = _helper2.default.determineAssetType(filePath, _configurator2.default.build.types, _configurator2.default.path);
                            if (typeof type === 'string' && _configurator2.default.build.types[type]) {
                                const filePath = _helper2.default.renderFilePathTemplate(_helper2.default.stripLoader(_configurator2.default.files.compose.javaScript), { '[name]': chunkName });
                                /*
                                    NOTE: Close handler have to be
                                    synchronous.
                                */
                                if (_configurator2.default.build.types[type].outputExtension === 'js' && _clientnode2.default.isFileSync(filePath)) fileSystem.chmodSync(filePath, '755');
                            }
                        }
                        for (const filePath of _configurator2.default.path.tidyUp) if (filePath && _clientnode2.default.isFileSync(filePath))
                            // NOTE: Close handler have to be synchronous.
                            fileSystem.unlinkSync(filePath);
                    };
                    closeEventHandlers.push(tidyUp);
                    /*
                        Triggers complete asset compiling and bundles them into the
                        final productive output.
                    */
                    processPromises.push(new _promise2.default(function (resolve, reject) {
                        const commandLineArguments = (_configurator2.default.commandLine.build.arguments || []).concat(additionalArguments);
                        console.info('Running "' + (`${_configurator2.default.commandLine.build.command} ` + commandLineArguments.join(' ')).trim() + '"');
                        const childProcess = (0, _child_process.spawn)(_configurator2.default.commandLine.build.command, commandLineArguments, childProcessOptions);
                        const copyAdditionalFilesAndTidyUp = function (...parameter) {
                            for (const filePath of _configurator2.default.files.additionalPaths) {
                                const sourcePath = _path2.default.join(_configurator2.default.path.source.base, filePath);
                                const targetPath = _path2.default.join(_configurator2.default.path.target.base, filePath);
                                // NOTE: Close handler have to be synchronous.
                                if (_clientnode2.default.isDirectorySync(sourcePath)) {
                                    if (_clientnode2.default.isDirectorySync(targetPath)) _rimraf2.default.sync(targetPath, { glob: false });
                                    _clientnode2.default.copyDirectoryRecursiveSync(sourcePath, targetPath);
                                } else if (_clientnode2.default.isFileSync(sourcePath)) _clientnode2.default.copyFileSync(sourcePath, targetPath);
                            }
                            tidyUp(...parameter);
                        };
                        const closeHandler = _clientnode2.default.getProcessCloseHandler(resolve, reject, null, process.argv[2] === 'build' ? copyAdditionalFilesAndTidyUp : tidyUp);
                        for (const closeEventName of _clientnode2.default.closeEventNames) childProcess.on(closeEventName, closeHandler);
                        childProcesses.push(childProcess);
                    }));
                    // endregion
                    // region handle preinstall
                } else if (_configurator2.default.library && _configurator2.default.givenCommandLineArguments[2] === 'preinstall') {
                    // Perform all file specific preprocessing stuff.
                    const testModuleFilePaths = _helper2.default.determineModuleLocations(_configurator2.default['test:browser'].injection.internal, _configurator2.default.module.aliases, _configurator2.default.module.replacements.normal, _configurator2.default.extensions, _configurator2.default.path.context, _configurator2.default.path.source.asset.base, _configurator2.default.path.ignore).filePaths;
                    for (const buildConfiguration of buildConfigurations) for (const filePath of buildConfiguration.filePaths) if (!testModuleFilePaths.includes(filePath)) {
                        const evaluationFunction = function (global, self, buildConfiguration, path, additionalArguments, filePath
                        // IgnoreTypeCheck
                        ) {
                            return new Function('global', 'self', 'buildConfiguration', 'path', 'additionalArguments', 'filePath', 'return `' + buildConfiguration[_configurator2.default.givenCommandLineArguments[2]].trim() + '`')(global, self, buildConfiguration, path, additionalArguments, filePath);
                        };
                        const command = evaluationFunction(global, _configurator2.default, buildConfiguration, _path2.default, additionalArguments, filePath);
                        console.info(`Running "${command}"`);
                        processPromises.push(new _promise2.default(function (resolve, reject) {
                            return _clientnode2.default.handleChildProcess((0, _child_process.exec)(command, childProcessOptions, function (error) {
                                return error ? reject(error) : resolve();
                            }));
                        }));
                    }
                }
                // endregion
                // region handle remaining tasks
                const handleTask = function (type) {
                    let tasks;
                    if (Array.isArray(_configurator2.default.commandLine[type])) tasks = _configurator2.default.commandLine[type];else tasks = [_configurator2.default.commandLine[type]];
                    for (const task of tasks) {
                        const evaluationFunction = function (global, self, path
                        // IgnoreTypeCheck
                        ) {
                            return new Function('global', 'self', 'path', 'return ' + (task.hasOwnProperty('indicator') ? task.indicator : 'true'))(global, self, path);
                        };
                        if (evaluationFunction(global, _configurator2.default, _path2.default)) processPromises.push(new _promise2.default(function (resolve, reject) {
                            const commandLineArguments = (task.arguments || []).concat(additionalArguments);
                            console.info('Running "' + (`${task.command} ` + commandLineArguments.join(' ')).trim() + '"');
                            const childProcess = (0, _child_process.spawn)(task.command, commandLineArguments, childProcessOptions);
                            const closeHandler = _clientnode2.default.getProcessCloseHandler(resolve, reject);
                            for (const closeEventName of _clientnode2.default.closeEventNames) childProcess.on(closeEventName, closeHandler);
                            childProcesses.push(childProcess);
                        }));
                    }
                };
                // / region a-/synchronous
                if (['document', 'test'].includes(_configurator2.default.givenCommandLineArguments[2])) {
                    yield _promise2.default.all(processPromises);
                    handleTask(_configurator2.default.givenCommandLineArguments[2]);
                } else if (['lint', 'test:browser', 'check:type', 'serve'].includes(_configurator2.default.givenCommandLineArguments[2])) handleTask(_configurator2.default.givenCommandLineArguments[2]);
                // / endregion
                // endregion
            }
            let finished = false;
            const closeHandler = function (...parameter) {
                if (!finished) for (const closeEventHandler of closeEventHandlers) closeEventHandler(...parameter);
                finished = true;
            };
            for (const closeEventName of _clientnode2.default.closeEventNames) process.on(closeEventName, closeHandler);
            if (require.main === module && (_configurator2.default.givenCommandLineArguments.length < 3 || !possibleArguments.includes(_configurator2.default.givenCommandLineArguments[2]))) console.info(`Give one of "${possibleArguments.join('", "')}" as command ` + 'line argument. You can provide a json string as second ' + 'parameter to dynamically overwrite some configurations.\n');
            // endregion
            // region forward nested return codes
            try {
                yield _promise2.default.all(processPromises);
            } catch (error) {
                process.exit(error.returnCode);
            }
            // endregion
        } catch (error) {
            if (_configurator2.default.debug) throw error;else console.error(error);
        }
    });

    return function main() {
        return _ref.apply(this, arguments);
    };
})();
if (require.main === module) main().catch(error => {
    throw error;
});
exports.default = main;
// region vim modline
// vim: set tabstop=4 shiftwidth=4 expandtab:
// vim: foldmethod=marker foldmarker=region,endregion:
// endregion

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQXhDLEdBQWlELENBQWpELElBQ0EsQ0FBQyxrQkFBa0IsUUFBbEIsQ0FDRyx1QkFBYyx5QkFBZCxDQUF3QyxDQUF4QyxDQURILENBRkQsQ0FBSixFQUtJLFFBQVEsSUFBUixDQUNLLGdCQUFlLGtCQUFrQixJQUFsQixDQUF1QixNQUF2QixDQUErQixlQUEvQyxHQUNBLHlEQURBLEdBRUEsMkRBSEo7QUFJSjtBQUNBO0FBQ0EsZ0JBQUk7QUFDQSxzQkFBTSxrQkFBUSxHQUFSLENBQVksZUFBWixDQUFOO0FBQ0gsYUFGRCxDQUVFLE9BQU8sS0FBUCxFQUFjO0FBQ1osd0JBQVEsSUFBUixDQUFhLE1BQU0sVUFBbkI7QUFDSDtBQUNEO0FBQ0gsU0FoYUQsQ0FnYUUsT0FBTyxLQUFQLEVBQWM7QUFDWixnQkFBSSx1QkFBYyxLQUFsQixFQUNJLE1BQU0sS0FBTixDQURKLEtBR0ksUUFBUSxLQUFSLENBQWMsS0FBZDtBQUNQO0FBQ0osS0F2YUs7O0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBTjtBQXdhQSxJQUFJLFFBQVEsSUFBUixLQUFpQixNQUFyQixFQUNJLE9BQU8sS0FBUCxDQUFjLEtBQUQsSUFBc0I7QUFDL0IsVUFBTSxLQUFOO0FBQ0gsQ0FGRDtrQkFHVyxJO0FBQ2Y7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiaW5kZXguY29tcGlsZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8vIEBmbG93XG4vLyAtKi0gY29kaW5nOiB1dGYtOCAtKi1cbid1c2Ugc3RyaWN0J1xuLyogIVxuICAgIHJlZ2lvbiBoZWFkZXJcbiAgICBDb3B5cmlnaHQgVG9yYmVuIFNpY2tlcnQgKGluZm9bXCJ+YXR+XCJddG9yYmVuLndlYnNpdGUpIDE2LjEyLjIwMTJcblxuICAgIExpY2Vuc2VcbiAgICAtLS0tLS0tXG5cbiAgICBUaGlzIGxpYnJhcnkgd3JpdHRlbiBieSBUb3JiZW4gU2lja2VydCBzdGFuZCB1bmRlciBhIGNyZWF0aXZlIGNvbW1vbnMgbmFtaW5nXG4gICAgMy4wIHVucG9ydGVkIGxpY2Vuc2UuIHNlZSBodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS8zLjAvZGVlZC5kZVxuICAgIGVuZHJlZ2lvblxuKi9cbi8vIHJlZ2lvbiBpbXBvcnRzXG5pbXBvcnQge1xuICAgIENoaWxkUHJvY2VzcywgZXhlYyBhcyBleGVjQ2hpbGRQcm9jZXNzLCBzcGF3biBhcyBzcGF3bkNoaWxkUHJvY2Vzc1xufSBmcm9tICdjaGlsZF9wcm9jZXNzJ1xuaW1wb3J0IFRvb2xzIGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgdHlwZSB7RmlsZSwgUGxhaW5PYmplY3R9IGZyb20gJ2NsaWVudG5vZGUnXG5pbXBvcnQgKiBhcyBmaWxlU3lzdGVtIGZyb20gJ2ZzJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseSBmcm9tICdyaW1yYWYnXG4vLyBOT1RFOiBPbmx5IG5lZWRlZCBmb3IgZGVidWdnaW5nIHRoaXMgZmlsZS5cbnRyeSB7XG4gICAgcmVxdWlyZSgnc291cmNlLW1hcC1zdXBwb3J0L3JlZ2lzdGVyJylcbn0gY2F0Y2ggKGVycm9yKSB7fVxuXG5pbXBvcnQgY29uZmlndXJhdGlvbiBmcm9tICcuL2NvbmZpZ3VyYXRvci5jb21waWxlZCdcbmltcG9ydCBIZWxwZXIgZnJvbSAnLi9oZWxwZXIuY29tcGlsZWQnXG5pbXBvcnQgdHlwZSB7UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb259IGZyb20gJy4vdHlwZSdcbi8vIGVuZHJlZ2lvblxuLy8gTk9URTogU3BlY2lmaWVzIG51bWJlciBvZiBhbGxvd2VkIHRocmVhZHMgdG8gc3Bhd24uXG4vLyBJZ25vcmVUeXBlQ2hlY2tcbnByb2Nlc3MuZW52LlVWX1RIUkVBRFBPT0xfU0laRSA9IDEyOFxuY29uc3QgbWFpbiA9IGFzeW5jICgpOlByb21pc2U8YW55PiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gcmVnaW9uIGNvbnRyb2xsZXJcbiAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzT3B0aW9uczpPYmplY3QgPSB7XG4gICAgICAgICAgICBjd2Q6IGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgZW52OiBwcm9jZXNzLmVudixcbiAgICAgICAgICAgIHNoZWxsOiB0cnVlLFxuICAgICAgICAgICAgc3RkaW86ICdpbmhlcml0J1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoaWxkUHJvY2Vzc2VzOkFycmF5PENoaWxkUHJvY2Vzcz4gPSBbXVxuICAgICAgICBjb25zdCBwcm9jZXNzUHJvbWlzZXM6QXJyYXk8UHJvbWlzZTxhbnk+PiA9IFtdXG4gICAgICAgIGNvbnN0IHBvc3NpYmxlQXJndW1lbnRzOkFycmF5PHN0cmluZz4gPSBbXG4gICAgICAgICAgICAnYnVpbGQnLCAnYnVpbGQ6ZGxsJywgJ2NsZWFyJywgJ2RvY3VtZW50JywgJ2xpbnQnLCAncHJlaW5zdGFsbCcsXG4gICAgICAgICAgICAnc2VydmUnLCAndGVzdCcsICd0ZXN0OmJyb3dzZXInLCAnY2hlY2s6dHlwZSddXG4gICAgICAgIGNvbnN0IGNsb3NlRXZlbnRIYW5kbGVyczpBcnJheTxGdW5jdGlvbj4gPSBbXVxuICAgICAgICBpZiAoY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgIC8vIHJlZ2lvbiB0ZW1wb3Jhcnkgc2F2ZSBkeW5hbWljYWxseSBnaXZlbiBjb25maWd1cmF0aW9uc1xuICAgICAgICAgICAgLy8gTk9URTogV2UgbmVlZCBhIGNvcHkgb2YgZ2l2ZW4gYXJndW1lbnRzIGFycmF5LlxuICAgICAgICAgICAgbGV0IGR5bmFtaWNDb25maWd1cmF0aW9uOlBsYWluT2JqZWN0ID0ge2dpdmVuQ29tbWFuZExpbmVBcmd1bWVudHM6XG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLnNsaWNlKCl9XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzLmxlbmd0aCA+IDMgJiZcbiAgICAgICAgICAgICAgICBUb29scy5zdHJpbmdQYXJzZUVuY29kZWRPYmplY3QoXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1tcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5sZW5ndGggLSAxXSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbiwgJ2NvbmZpZ3VyYXRpb24nKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5wb3AoKVxuICAgICAgICAgICAgbGV0IGNvdW50Om51bWJlciA9IDBcbiAgICAgICAgICAgIGxldCBmaWxlUGF0aDpzdHJpbmcgPSBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsXG4gICAgICAgICAgICAgICAgYC5keW5hbWljQ29uZmlndXJhdGlvbi0ke2NvdW50fS5qc29uYClcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgZmlsZVBhdGggPSBwYXRoLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgICAgICAgICBgLmR5bmFtaWNDb25maWd1cmF0aW9uLSR7Y291bnR9Lmpzb25gKVxuICAgICAgICAgICAgICAgIGlmICghKGF3YWl0IFRvb2xzLmlzRmlsZShmaWxlUGF0aCkpKVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIGNvdW50ICs9IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb24pOnZvaWQgPT5cbiAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLndyaXRlRmlsZShmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgICAgICAgICAgIGR5bmFtaWNDb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgKSwgKGVycm9yOj9FcnJvcik6dm9pZCA9PiBlcnJvciA/IHJlamVjdChlcnJvcikgOiByZXNvbHZlKCkpKVxuICAgICAgICAgICAgY29uc3QgYWRkaXRpb25hbEFyZ3VtZW50czpBcnJheTxzdHJpbmc+ID0gcHJvY2Vzcy5hcmd2LnNwbGljZSgzKVxuICAgICAgICAgICAgLy8gLyByZWdpb24gcmVnaXN0ZXIgZXhpdCBoYW5kbGVyIHRvIHRpZHkgdXBcbiAgICAgICAgICAgIGNsb3NlRXZlbnRIYW5kbGVycy5wdXNoKChlcnJvcjo/RXJyb3IpOnZvaWQgPT4ge1xuICAgICAgICAgICAgICAgIC8vIE5PVEU6IENsb3NlIGhhbmRsZXIgaGF2ZSB0byBiZSBzeW5jaHJvbm91cy5cbiAgICAgICAgICAgICAgICBpZiAoVG9vbHMuaXNGaWxlU3luYyhmaWxlUGF0aCkpXG4gICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0udW5saW5rU3luYyhmaWxlUGF0aClcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy8gLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICAgICAgLy8gcmVnaW9uIGhhbmRsZSBjbGVhclxuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICBOT1RFOiBTb21lIHRhc2tzIGNvdWxkIGRlcGVuZCBvbiBwcmV2aW91c2x5IGNyZWF0ZWQgZGxsXG4gICAgICAgICAgICAgICAgcGFja2FnZXMgc28gYSBjbGVhbiBzaG91bGQgbm90IGJlIHBlcmZvcm1lZCBpbiB0aGF0IGNhc2UuXG4gICAgICAgICAgICAgICAgTk9URTogSWYgd2UgaGF2ZSBhIGRlcGVuZGVuY3kgY3ljbGUgd2UgbmVlZCB0byBwcmVzZXJ2ZSBmaWxlc1xuICAgICAgICAgICAgICAgIGR1cmluZyBwcmVpbnN0YWxsIHBoYXNlLlxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmICghW1xuICAgICAgICAgICAgICAgICdidWlsZCcsICdwcmVpbnN0YWxsJywgJ3NlcnZlJywgJ3Rlc3QnLCAndGVzdDpicm93c2VyJ1xuICAgICAgICAgICAgXS5pbmNsdWRlcyhjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0pICYmXG4gICAgICAgICAgICBwb3NzaWJsZUFyZ3VtZW50cy5pbmNsdWRlcyhcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl1cbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgICBpZiAocGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGgudGFyZ2V0LmJhc2VcbiAgICAgICAgICAgICAgICApID09PSBwYXRoLnJlc29sdmUoY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZXMgYWxsIGNvbXBpbGVkIGZpbGVzLlxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBUb29scy53YWxrRGlyZWN0b3J5UmVjdXJzaXZlbHkoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGgudGFyZ2V0LmJhc2UsIGFzeW5jIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlOkZpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICk6UHJvbWlzZTw/ZmFsc2U+ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSGVscGVyLmlzRmlsZVBhdGhJbkxvY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGgsIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmUuY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUuZGlyZWN0b3J5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmxvYWRlci5kaXJlY3RvcnlOYW1lc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLm1hcCgoZmlsZVBhdGg6c3RyaW5nKTpzdHJpbmcgPT4gcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsIGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLmZpbHRlcigoZmlsZVBhdGg6c3RyaW5nKTpib29sZWFuID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQuc3RhcnRzV2l0aChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHlwZTpzdHJpbmcgaW4gY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ldyBSZWdFeHAoY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5maWxlUGF0aFBhdHRlcm4pLnRlc3QoZmlsZS5wYXRoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuc3RhdC5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOkZ1bmN0aW9uLCByZWplY3Q6RnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gcmVtb3ZlRGlyZWN0b3J5UmVjdXJzaXZlbHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucGF0aCwge2dsb2I6IGZhbHNlfSwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6P0Vycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgOiByZXNvbHZlKCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGZpbGVTeXN0ZW0udW5saW5rKGZpbGUucGF0aCwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGVycm9yID8gcmVqZWN0KGVycm9yKSA6IHJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlOkZpbGUgb2YgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFRvb2xzLndhbGtEaXJlY3RvcnlSZWN1cnNpdmVseShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLnRhcmdldC5iYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKTpmYWxzZSA9PiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5lbmNvZGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLm5hbWUubGVuZ3RoID4gJy5kbGwtbWFuaWZlc3QuanNvbicubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5uYW1lLmVuZHNXaXRoKCcuZGxsLW1hbmlmZXN0Lmpzb24nKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUubmFtZS5zdGFydHNXaXRoKCducG0tZGVidWcnKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGZpbGVTeXN0ZW0udW5saW5rKGZpbGUucGF0aCwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjo/RXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gZXJyb3IgPyByZWplY3QoZXJyb3IpIDogcmVzb2x2ZSgpKSlcbiAgICAgICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiByZW1vdmVEaXJlY3RvcnlSZWN1cnNpdmVseShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwge2dsb2I6IGZhbHNlfSwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGVycm9yID8gcmVqZWN0KGVycm9yKSA6IHJlc29sdmUoKSkpXG4gICAgICAgICAgICAgICAgaWYgKGF3YWl0IFRvb2xzLmlzRGlyZWN0b3J5KFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguYXBpRG9jdW1lbnRhdGlvblxuICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4gcmVtb3ZlRGlyZWN0b3J5UmVjdXJzaXZlbHkoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguYXBpRG9jdW1lbnRhdGlvbiwge2dsb2I6IGZhbHNlfSwgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOj9FcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IGVycm9yID8gcmVqZWN0KGVycm9yKSA6IHJlc29sdmUoKSkpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIHJlZ2lvbiBoYW5kbGUgYnVpbGRcbiAgICAgICAgICAgIGNvbnN0IGJ1aWxkQ29uZmlndXJhdGlvbnM6UmVzb2x2ZWRCdWlsZENvbmZpZ3VyYXRpb24gPVxuICAgICAgICAgICAgICAgIEhlbHBlci5yZXNvbHZlQnVpbGRDb25maWd1cmF0aW9uRmlsZVBhdGhzKFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmJ1aWxkLnR5cGVzLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguc291cmNlLmFzc2V0LmJhc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5pZ25vcmUuY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUuZGlyZWN0b3J5TmFtZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmxvYWRlci5kaXJlY3RvcnlOYW1lc1xuICAgICAgICAgICAgICAgICAgICApLm1hcCgoZmlsZVBhdGg6c3RyaW5nKTpzdHJpbmcgPT4gcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsIGZpbGVQYXRoKVxuICAgICAgICAgICAgICAgICAgICApLmZpbHRlcigoZmlsZVBhdGg6c3RyaW5nKTpib29sZWFuID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAhY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQuc3RhcnRzV2l0aChmaWxlUGF0aCkpLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2UubWFpbi5maWxlTmFtZXMpXG4gICAgICAgICAgICBpZiAoWydidWlsZCcsICdidWlsZDpkbGwnLCAnZG9jdW1lbnQnLCAndGVzdCddLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIHByb2Nlc3MuYXJndlsyXVxuICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICAgIGxldCB0aWRpZWRVcDpib29sZWFuID0gZmFsc2VcbiAgICAgICAgICAgICAgICBjb25zdCB0aWR5VXA6RnVuY3Rpb24gPSAoKTp2b2lkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgIERldGVybWluZXMgYWxsIG5vbmUgamF2YVNjcmlwdCBlbnRpdGllcyB3aGljaCBoYXZlIGJlZW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVtaXR0ZWQgYXMgc2luZ2xlIG1vZHVsZSB0byByZW1vdmUuXG4gICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aWRpZWRVcClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgICAgICB0aWRpZWRVcCA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNodW5rTmFtZTpzdHJpbmcgaW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uaW5qZWN0aW9uLmludGVybmFsLm5vcm1hbGl6ZWRcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24uaW5qZWN0aW9uLmludGVybmFsLm5vcm1hbGl6ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaGFzT3duUHJvcGVydHkoY2h1bmtOYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbW9kdWxlSUQ6c3RyaW5nIG9mIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmluamVjdGlvbi5pbnRlcm5hbC5ub3JtYWxpemVkW2NodW5rTmFtZV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZVBhdGg6P3N0cmluZyA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWxwZXIuZGV0ZXJtaW5lTW9kdWxlRmlsZVBhdGgoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlSUQsIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmFsaWFzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUucmVwbGFjZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5ub3JtYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5leHRlbnNpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5jb250ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5zb3VyY2UuYXNzZXQuYmFzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ubW9kdWxlLmRpcmVjdG9yeU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGFja2FnZS5tYWluLmZpbGVOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2UubWFpblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucHJvcGVydHlOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhY2thZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFsaWFzUHJvcGVydHlOYW1lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmVuY29kaW5nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdHlwZTo/c3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBIZWxwZXIuZGV0ZXJtaW5lQXNzZXRUeXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoLCBjb25maWd1cmF0aW9uLmJ1aWxkLnR5cGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmJ1aWxkLnR5cGVzW3R5cGVdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZVBhdGg6c3RyaW5nID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWxwZXIucmVuZGVyRmlsZVBhdGhUZW1wbGF0ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVscGVyLnN0cmlwTG9hZGVyKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5maWxlcy5jb21wb3NlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmphdmFTY3JpcHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwgeydbbmFtZV0nOiBjaHVua05hbWV9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT1RFOiBDbG9zZSBoYW5kbGVyIGhhdmUgdG8gYmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbm91cy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5idWlsZC50eXBlc1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0ub3V0cHV0RXh0ZW5zaW9uID09PSAnanMnICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVG9vbHMuaXNGaWxlU3luYyhmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLmNobW9kU3luYyhmaWxlUGF0aCwgJzc1NScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZVBhdGg6P3N0cmluZyBvZiBjb25maWd1cmF0aW9uLnBhdGgudGlkeVVwKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVQYXRoICYmIFRvb2xzLmlzRmlsZVN5bmMoZmlsZVBhdGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5PVEU6IENsb3NlIGhhbmRsZXIgaGF2ZSB0byBiZSBzeW5jaHJvbm91cy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnVubGlua1N5bmMoZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNsb3NlRXZlbnRIYW5kbGVycy5wdXNoKHRpZHlVcClcbiAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICBUcmlnZ2VycyBjb21wbGV0ZSBhc3NldCBjb21waWxpbmcgYW5kIGJ1bmRsZXMgdGhlbSBpbnRvIHRoZVxuICAgICAgICAgICAgICAgICAgICBmaW5hbCBwcm9kdWN0aXZlIG91dHB1dC5cbiAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHByb2Nlc3NQcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgKTp2b2lkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZExpbmVBcmd1bWVudHM6QXJyYXk8c3RyaW5nPiA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uY29tbWFuZExpbmUuYnVpbGQuYXJndW1lbnRzIHx8IFtdXG4gICAgICAgICAgICAgICAgICAgICkuY29uY2F0KGFkZGl0aW9uYWxBcmd1bWVudHMpXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnUnVubmluZyBcIicgKyAoXG4gICAgICAgICAgICAgICAgICAgICAgICBgJHtjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lLmJ1aWxkLmNvbW1hbmR9IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZExpbmVBcmd1bWVudHMuam9pbignICcpXG4gICAgICAgICAgICAgICAgICAgICkudHJpbSgpICsgJ1wiJylcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzOkNoaWxkUHJvY2VzcyA9IHNwYXduQ2hpbGRQcm9jZXNzKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5jb21tYW5kTGluZS5idWlsZC5jb21tYW5kLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZExpbmVBcmd1bWVudHMsIGNoaWxkUHJvY2Vzc09wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvcHlBZGRpdGlvbmFsRmlsZXNBbmRUaWR5VXA6RnVuY3Rpb24gPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5wYXJhbWV0ZXI6QXJyYXk8YW55PlxuICAgICAgICAgICAgICAgICAgICApOnZvaWQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlUGF0aDpzdHJpbmcgb2ZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmZpbGVzLmFkZGl0aW9uYWxQYXRoc1xuICAgICAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlUGF0aDpzdHJpbmcgPSBwYXRoLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC5zb3VyY2UuYmFzZSwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0UGF0aDpzdHJpbmcgPSBwYXRoLmpvaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucGF0aC50YXJnZXQuYmFzZSwgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTk9URTogQ2xvc2UgaGFuZGxlciBoYXZlIHRvIGJlIHN5bmNocm9ub3VzLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChUb29scy5pc0RpcmVjdG9yeVN5bmMoc291cmNlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRvb2xzLmlzRGlyZWN0b3J5U3luYyh0YXJnZXRQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZURpcmVjdG9yeVJlY3Vyc2l2ZWx5LnN5bmMoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0UGF0aCwge2dsb2I6IGZhbHNlfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVG9vbHMuY29weURpcmVjdG9yeVJlY3Vyc2l2ZVN5bmMoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VQYXRoLCB0YXJnZXRQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoVG9vbHMuaXNGaWxlU3luYyhzb3VyY2VQYXRoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVG9vbHMuY29weUZpbGVTeW5jKHNvdXJjZVBhdGgsIHRhcmdldFBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aWR5VXAoLi4ucGFyYW1ldGVyKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlSGFuZGxlcjpGdW5jdGlvbiA9IFRvb2xzLmdldFByb2Nlc3NDbG9zZUhhbmRsZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlLCByZWplY3QsIG51bGwsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmFyZ3ZbMl0gPT09ICdidWlsZCdcbiAgICAgICAgICAgICAgICAgICAgICAgICkgPyBjb3B5QWRkaXRpb25hbEZpbGVzQW5kVGlkeVVwIDogdGlkeVVwKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNsb3NlRXZlbnROYW1lOnN0cmluZyBvZiBUb29scy5jbG9zZUV2ZW50TmFtZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFByb2Nlc3Mub24oY2xvc2VFdmVudE5hbWUsIGNsb3NlSGFuZGxlcilcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzZXMucHVzaChjaGlsZFByb2Nlc3MpXG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIHJlZ2lvbiBoYW5kbGUgcHJlaW5zdGFsbFxuICAgICAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmxpYnJhcnkgJiZcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0gPT09ICdwcmVpbnN0YWxsJ1xuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgLy8gUGVyZm9ybSBhbGwgZmlsZSBzcGVjaWZpYyBwcmVwcm9jZXNzaW5nIHN0dWZmLlxuICAgICAgICAgICAgICAgIGNvbnN0IHRlc3RNb2R1bGVGaWxlUGF0aHM6QXJyYXk8c3RyaW5nPiA9XG4gICAgICAgICAgICAgICAgICAgIEhlbHBlci5kZXRlcm1pbmVNb2R1bGVMb2NhdGlvbnMoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uWyd0ZXN0OmJyb3dzZXInXS5pbmplY3Rpb24uaW50ZXJuYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLm1vZHVsZS5hbGlhc2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5tb2R1bGUucmVwbGFjZW1lbnRzLm5vcm1hbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZXh0ZW5zaW9ucywgY29uZmlndXJhdGlvbi5wYXRoLmNvbnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguc291cmNlLmFzc2V0LmJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnBhdGguaWdub3JlXG4gICAgICAgICAgICAgICAgICAgICkuZmlsZVBhdGhzXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBidWlsZENvbmZpZ3VyYXRpb24gb2YgYnVpbGRDb25maWd1cmF0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlUGF0aDpzdHJpbmcgb2YgYnVpbGRDb25maWd1cmF0aW9uLmZpbGVQYXRocylcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGVzdE1vZHVsZUZpbGVQYXRocy5pbmNsdWRlcyhmaWxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBldmFsdWF0aW9uRnVuY3Rpb24gPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbDpPYmplY3QsIHNlbGY6UGxhaW5PYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkQ29uZmlndXJhdGlvbjpQbGFpbk9iamVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDp0eXBlb2YgcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbEFyZ3VtZW50czpBcnJheTxzdHJpbmc+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aDpzdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOnN0cmluZyA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmVUeXBlQ2hlY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEZ1bmN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dsb2JhbCcsICdzZWxmJywgJ2J1aWxkQ29uZmlndXJhdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF0aCcsICdhZGRpdGlvbmFsQXJndW1lbnRzJywgJ2ZpbGVQYXRoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXR1cm4gYCcgKyBidWlsZENvbmZpZ3VyYXRpb25bXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXS50cmltKCkgKyAnYCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCwgc2VsZiwgYnVpbGRDb25maWd1cmF0aW9uLCBwYXRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbEFyZ3VtZW50cywgZmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZDpzdHJpbmcgPSBldmFsdWF0aW9uRnVuY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbCwgY29uZmlndXJhdGlvbiwgYnVpbGRDb25maWd1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoLCBhZGRpdGlvbmFsQXJndW1lbnRzLCBmaWxlUGF0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oYFJ1bm5pbmcgXCIke2NvbW1hbmR9XCJgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NQcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IFRvb2xzLmhhbmRsZUNoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY0NoaWxkUHJvY2VzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQsIGNoaWxkUHJvY2Vzc09wdGlvbnMsIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjo/RXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk6dm9pZCA9PiBlcnJvciA/IHJlamVjdChlcnJvcikgOiByZXNvbHZlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgICAgICAvLyByZWdpb24gaGFuZGxlIHJlbWFpbmluZyB0YXNrc1xuICAgICAgICAgICAgY29uc3QgaGFuZGxlVGFzayA9ICh0eXBlOnN0cmluZyk6dm9pZCA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHRhc2tzOkFycmF5PE9iamVjdD5cbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdKSlcbiAgICAgICAgICAgICAgICAgICAgdGFza3MgPSBjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0YXNrcyA9IFtjb25maWd1cmF0aW9uLmNvbW1hbmRMaW5lW3R5cGVdXVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdGFzazpPYmplY3Qgb2YgdGFza3MpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZhbHVhdGlvbkZ1bmN0aW9uID0gKFxuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsOk9iamVjdCwgc2VsZjpQbGFpbk9iamVjdCwgcGF0aDp0eXBlb2YgcGF0aFxuICAgICAgICAgICAgICAgICAgICApOmJvb2xlYW4gPT5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZVR5cGVDaGVja1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEZ1bmN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnbG9iYWwnLCAnc2VsZicsICdwYXRoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmV0dXJuICcgKyAodGFzay5oYXNPd25Qcm9wZXJ0eShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2luZGljYXRvcidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApID8gdGFzay5pbmRpY2F0b3IgOiAndHJ1ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICApKGdsb2JhbCwgc2VsZiwgcGF0aClcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2YWx1YXRpb25GdW5jdGlvbihnbG9iYWwsIGNvbmZpZ3VyYXRpb24sIHBhdGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Byb21pc2VzLnB1c2gobmV3IFByb21pc2UoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6RnVuY3Rpb24sIHJlamVjdDpGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgKTp2b2lkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kTGluZUFyZ3VtZW50czpBcnJheTxzdHJpbmc+ID0gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLmFyZ3VtZW50cyB8fCBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkuY29uY2F0KGFkZGl0aW9uYWxBcmd1bWVudHMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdSdW5uaW5nIFwiJyArIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7dGFzay5jb21tYW5kfSBgICsgY29tbWFuZExpbmVBcmd1bWVudHMuam9pbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLnRyaW0oKSArICdcIicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRQcm9jZXNzOkNoaWxkUHJvY2VzcyA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduQ2hpbGRQcm9jZXNzKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5jb21tYW5kLCBjb21tYW5kTGluZUFyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkUHJvY2Vzc09wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xvc2VIYW5kbGVyOkZ1bmN0aW9uID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVG9vbHMuZ2V0UHJvY2Vzc0Nsb3NlSGFuZGxlcihyZXNvbHZlLCByZWplY3QpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xvc2VFdmVudE5hbWU6c3RyaW5nIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvb2xzLmNsb3NlRXZlbnROYW1lc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzLm9uKGNsb3NlRXZlbnROYW1lLCBjbG9zZUhhbmRsZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRQcm9jZXNzZXMucHVzaChjaGlsZFByb2Nlc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyAvIHJlZ2lvbiBhLS9zeW5jaHJvbm91c1xuICAgICAgICAgICAgaWYgKFsnZG9jdW1lbnQnLCAndGVzdCddLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXVxuICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHByb2Nlc3NQcm9taXNlcylcbiAgICAgICAgICAgICAgICBoYW5kbGVUYXNrKGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50c1syXSlcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoW1xuICAgICAgICAgICAgICAgICdsaW50JywgJ3Rlc3Q6YnJvd3NlcicsICdjaGVjazp0eXBlJywgJ3NlcnZlJ1xuICAgICAgICAgICAgXS5pbmNsdWRlcyhjb25maWd1cmF0aW9uLmdpdmVuQ29tbWFuZExpbmVBcmd1bWVudHNbMl0pKVxuICAgICAgICAgICAgICAgIGhhbmRsZVRhc2soY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdKVxuICAgICAgICAgICAgLy8gLyBlbmRyZWdpb25cbiAgICAgICAgICAgIC8vIGVuZHJlZ2lvblxuICAgICAgICB9XG4gICAgICAgIGxldCBmaW5pc2hlZDpib29sZWFuID0gZmFsc2VcbiAgICAgICAgY29uc3QgY2xvc2VIYW5kbGVyID0gKC4uLnBhcmFtZXRlcjpBcnJheTxhbnk+KTp2b2lkID0+IHtcbiAgICAgICAgICAgIGlmICghZmluaXNoZWQpXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjbG9zZUV2ZW50SGFuZGxlcjpGdW5jdGlvbiBvZiBjbG9zZUV2ZW50SGFuZGxlcnMpXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlRXZlbnRIYW5kbGVyKC4uLnBhcmFtZXRlcilcbiAgICAgICAgICAgIGZpbmlzaGVkID0gdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgY2xvc2VFdmVudE5hbWU6c3RyaW5nIG9mIFRvb2xzLmNsb3NlRXZlbnROYW1lcylcbiAgICAgICAgICAgIHByb2Nlc3Mub24oY2xvc2VFdmVudE5hbWUsIGNsb3NlSGFuZGxlcilcbiAgICAgICAgaWYgKHJlcXVpcmUubWFpbiA9PT0gbW9kdWxlICYmIChcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uZ2l2ZW5Db21tYW5kTGluZUFyZ3VtZW50cy5sZW5ndGggPCAzIHx8XG4gICAgICAgICAgICAhcG9zc2libGVBcmd1bWVudHMuaW5jbHVkZXMoXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbi5naXZlbkNvbW1hbmRMaW5lQXJndW1lbnRzWzJdKVxuICAgICAgICApKVxuICAgICAgICAgICAgY29uc29sZS5pbmZvKFxuICAgICAgICAgICAgICAgIGBHaXZlIG9uZSBvZiBcIiR7cG9zc2libGVBcmd1bWVudHMuam9pbignXCIsIFwiJyl9XCIgYXMgY29tbWFuZCBgICtcbiAgICAgICAgICAgICAgICAnbGluZSBhcmd1bWVudC4gWW91IGNhbiBwcm92aWRlIGEganNvbiBzdHJpbmcgYXMgc2Vjb25kICcgK1xuICAgICAgICAgICAgICAgICdwYXJhbWV0ZXIgdG8gZHluYW1pY2FsbHkgb3ZlcndyaXRlIHNvbWUgY29uZmlndXJhdGlvbnMuXFxuJylcbiAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgIC8vIHJlZ2lvbiBmb3J3YXJkIG5lc3RlZCByZXR1cm4gY29kZXNcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHByb2Nlc3NQcm9taXNlcylcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdChlcnJvci5yZXR1cm5Db2RlKVxuICAgICAgICB9XG4gICAgICAgIC8vIGVuZHJlZ2lvblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uLmRlYnVnKVxuICAgICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcilcbiAgICB9XG59XG5pZiAocmVxdWlyZS5tYWluID09PSBtb2R1bGUpXG4gICAgbWFpbigpLmNhdGNoKChlcnJvcjpFcnJvcik6dm9pZCA9PiB7XG4gICAgICAgIHRocm93IGVycm9yXG4gICAgfSlcbmV4cG9ydCBkZWZhdWx0IG1haW5cbi8vIHJlZ2lvbiB2aW0gbW9kbGluZVxuLy8gdmltOiBzZXQgdGFic3RvcD00IHNoaWZ0d2lkdGg9NCBleHBhbmR0YWI6XG4vLyB2aW06IGZvbGRtZXRob2Q9bWFya2VyIGZvbGRtYXJrZXI9cmVnaW9uLGVuZHJlZ2lvbjpcbi8vIGVuZHJlZ2lvblxuIl19